name: medical_agent
version: "1.0"
description: "医疗分身Agent流程"

nodes:
  # 意图识别 - 使用快速模式
  - name: intent_recognition
    type: agent
    config:
      prompt: prompts/00-intent_recognition_agent.md
      model:
        provider: doubao
        name: doubao-seed-1-6-251015
        temperature: 0.7
        thinking:
          type: disabled  # 关闭深度思考，加速响应

  # 血压记录Agent - 使用轻量思考
  - name: blood_pressure_agent
    type: agent
    config:
      prompt: prompts/10-blood_pressure_agent.md
      model:
        provider: doubao
        name: doubao-seed-1-8-251228
        temperature: 0.7
        thinking:
          type: enabled  # 开启深度思考
        reasoning_effort: low  # 轻量思考，减少耗时
        timeout: 1800  # 30分钟超时（深度思考时建议设置）
      tools:
        - record_blood_pressure
        - query_blood_pressure
        - update_blood_pressure

  # QA Agent - 使用深度分析
  - name: qa_agent
    type: agent
    config:
      prompt: prompts/50-QA_agent.md
      model:
        provider: doubao
        name: doubao-seed-1-8-251228
        temperature: 0.7
        thinking:
          type: enabled  # 开启深度思考
        reasoning_effort: high  # 深度分析
        timeout: 1800  # 30分钟超时

  # 不明确意图Agent - 使用默认模式（不设置 thinking 和 reasoning_effort）
  - name: unclear_agent
    type: agent
    config:
      prompt: prompts/90-unclear-agent.md
      model:
        provider: doubao
        name: doubao-seed-1-6-251015
        temperature: 0.7
        # 不设置 thinking 和 reasoning_effort，使用模型默认行为

edges:
  - from: intent_recognition
    to: blood_pressure_agent
    condition: intent == "blood_pressure" && confidence >= 0.8
  
  - from: intent_recognition
    to: qa_agent
    condition: intent == "qa" && confidence >= 0.8
  
  - from: intent_recognition
    to: unclear_agent
    condition: intent == "greeting" || need_clarification == true
  
  # 已删除多余的 always 边，Agent 节点执行完成后流程自动结束
  # 多轮对话通过新的 HTTP 请求来处理

entry_node: intent_recognition

