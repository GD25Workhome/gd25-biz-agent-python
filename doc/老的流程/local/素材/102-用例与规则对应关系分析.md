# 血压点评用例与规则对应关系分析

## 一、用例分类与规则对应关系

### 1. 单次血压数据点评（对应提示词：1. 单次血压数据点评）

| CSV场景特征 | 提示词规则 | 对应关系 |
|------------|----------|---------|
| 血压达标 | "90<=收缩压<=收缩压目标值 且 舒张压<=舒张压目标值" → "达标" | ✅ 完全对应 |
| 低压偏低 | "20mmHg<舒张压<=60mmHg 且 舒张压<=舒张压目标值" → "低压偏低" | ✅ 完全对应 |
| 高压偏低 | "40mmHg<=收缩压<90mmHg 且 收缩压<=收缩压目标值" → "高压偏低（需预警，尽快回院）" | ✅ 完全对应 |
| 轻度偏高 | "收缩压、舒张压任一值超过了对应设定目标值，但两者超过了均不到10mmHg" → "轻度偏高" | ✅ 完全对应 |
| 中度偏高 | "收缩压、舒张压任一值超过了对应设定目标值+10mmHg；但未超过180/110" → "中度偏高" | ✅ 完全对应 |
| 重度偏高-无行为 | "收缩压>=180 or 舒张压>=110" → "重度偏高（需预警，尽快回院）" | ✅ 完全对应 |
| 重度偏高-有行为 | "收缩压>=180 or 舒张压>=110" + 症状 | ✅ 对应（结合症状预警规则） |
| 重度偏高-带症状 | "收缩压>=180 or 舒张压>=110" + 症状 | ✅ 对应（结合症状预警规则） |

### 2. 两次血压数据对比点评（对应提示词：2. 两次血压数据对比点评）

| CSV场景特征 | 提示词规则 | 对应关系 |
|------------|----------|---------|
| 波动较大且带症状 | "相比患者7天内的（如有）上一次血压SBP升高/降低40mmHg及以上或DBP升高/降低20mmHg" → "波动较大（若带症状需预警，尽快回院）" | ✅ 完全对应 |

### 3. 症状预警规则（对应提示词：5. 症状预警规则）

| CSV场景特征 | 提示词规则 | 对应关系 |
|------------|----------|---------|
| 首次记录症状 | "历史首次反馈【头昏头晕】【胸闷】【胸痛】【呼吸急促】【恶心腹胀】【视力模糊】【咳嗽】【肢体麻木】【夜尿增多】【血尿】之一" → "高血压患者首次给症状，且短期内未缓解（需预警，尽快回院）" | ✅ 完全对应 |
| 高脂血症患者服用他汀带症状 | "【肌肉酸痛】【肌肉不适】【肌肉无力】之一" → "高脂血症患者服用他汀带症状（需预警，尽快回院）" | ✅ 完全对应 |
| 冠心病患者血压不达标且带症状 | "【胸闷】【胸痛】【憋喘】之一" → "冠心病患者血压不达标且带症状（需预警，尽快回院）" | ✅ 完全对应 |

### 4. 脉搏点评参考规则（对应提示词：4. 脉搏点评参考规则）

| CSV场景特征 | 提示词规则 | 对应关系 |
|------------|----------|---------|
| 脉搏较慢 | "BPM≤40" → "脉搏较慢（需预警，尽快回院）" | ✅ 完全对应 |
| 脉搏偏慢 | "40<BPM<60" → "脉搏偏慢" | ⚠️ 部分对应（CSV中有更细分的区间） |
| 脉搏正常 | "60≤BPM≤80" → "脉搏正常" | ⚠️ 部分对应（CSV中为60<BPM≤75） |
| 脉搏偏快 | "80<BPM≤150" → "脉搏偏快" | ⚠️ 部分对应（CSV中有更细分的区间） |
| 脉搏较快 | "BPM>150" → "脉搏较快（需预警，尽快回院）" | ⚠️ 部分对应（CSV中为>150） |

**注意**：CSV中的脉搏区间划分更细致（如40<BPM≤50、50<BPM≤60、60<BPM≤75、75<BPM≤100、100<BPM≤120、120<BPM≤150），而提示词中的规则相对简化。

### 5. 血压趋势点评维度（对应提示词：3. 血压趋势点评维度）

#### 5.1 变化趋势（对应提示词：3.3 变化趋势）

| CSV场景特征 | 提示词规则 | 对应关系 |
|------------|----------|---------|
| 下降趋势，有任何不达标数据 | "当Ds与Dd均<2时" → "下降" | ✅ 对应（需结合达标情况） |
| 下降趋势，全部达标 | "当Ds与Dd均<2时" → "下降" | ✅ 对应（需结合达标情况） |
| 上升趋势，有任何不达标数据 | "当Ds与Dd均>2时" → "上升" | ✅ 对应（需结合达标情况） |
| 上升趋势，全部达标 | "当Ds与Dd均>2时" → "上升" | ✅ 对应（需结合达标情况） |
| 趋势为无变化，全部达标 | "-2 ≤Ds与Dd都在该区间 ≤2" → "无显著变化" | ✅ 对应（需结合达标情况） |
| 趋势为无变化，近7天达标率71%~99% | "-2 ≤Ds与Dd都在该区间 ≤2" → "无显著变化" | ✅ 对应（需结合达标率） |
| 趋势为无变化，近7天达标率50%~70% | "-2 ≤Ds与Dd都在该区间 ≤2" → "无显著变化" | ✅ 对应（需结合达标率） |
| 趋势为无变化，近7天达标率<50% | "-2 ≤Ds与Dd都在该区间 ≤2" → "无显著变化" | ✅ 对应（需结合达标率） |

#### 5.2 高压模式（对应提示词：3.2 高压模式）

| CSV场景特征 | 提示词规则 | 对应关系 |
|------------|----------|---------|
| 晨间高，时段收缩压、舒张压有不达标 | "晨间时段（2点-10点），当晨间平均收缩压高于全日平均收缩压10%时，且晨间测量3次，整体测量>6次" → "晨间高" | ✅ 对应（需结合达标情况） |
| 晨间高，时段收缩压、舒张压"全部"达标 | "晨间时段（2点-10点），当晨间平均收缩压高于全日平均收缩压10%时，且晨间测量3次，整体测量>6次" → "晨间高" | ✅ 对应（需结合达标情况） |
| 夜间高，时段收缩压、舒张压有不达标 | "夜间时段（18点-2点），当夜间平均收缩压高于全日平均收缩压10%时，且夜间测量>3次，整体测量>6次" → "夜间高" | ✅ 对应（需结合达标情况） |
| 夜间高，时段收缩压、舒张压"全部"达标 | "夜间时段（18点-2点），当夜间平均收缩压高于全日平均收缩压10%时，且夜间测量>3次，整体测量>6次" → "夜间高" | ✅ 对应（需结合达标情况） |
| 无突出模式，有时段有不达标的血压 | "晨间，夜间测量各大于三次，且不满足上面的两个条件" → "无突出模式" | ✅ 对应（需结合达标情况） |

## 二、直接加载CSV的可行性分析

### 2.1 CSV格式问题

1. **格式复杂**：
   - CSV包含大量空列（20+列）
   - 部分用例跨多行（如第2-3行是一个用例）
   - 包含特殊字符和模板变量（如`{症状}`、`[!不达标天数]`）

2. **结构不匹配**：
   - CSV是表格格式，不是对话格式
   - 缺少完整的输入输出对
   - 没有展示JSON输出格式要求

3. **信息冗余**：
   - 包含业务逻辑字段（如"是否需要展示医生近期门诊排班"）
   - 包含来源信息（"【医生分身】血压点评规则说明"）
   - 这些信息对模型理解任务没有帮助

### 2.2 模型理解偏差风险

**高风险问题**：

1. **格式混乱**：CSV的表格格式会让模型难以理解这是Few-shot示例
2. **缺少上下文**：没有展示完整的对话流程（用户输入 → 工具调用 → 点评输出）
3. **缺少JSON格式**：提示词要求JSON格式输出，但CSV中没有展示
4. **模板变量混淆**：`{症状}`、`[!不达标天数]`等变量可能让模型误以为是需要填充的占位符
5. **跨行问题**：部分用例跨多行，可能导致解析错误

### 2.3 建议方案

**不建议直接加载CSV**，原因：
- 格式不友好，模型难以理解
- 缺少完整的对话示例
- 不符合Few-shot示例的标准格式

**推荐方案**：

1. **转换为结构化Few-shot示例**：
   - 按照点评维度分类组织
   - 展示完整的输入输出对
   - 包含JSON格式的输出示例
   - 展示工具调用过程

2. **示例格式建议**：

```markdown
## 示例1：血压达标场景

**用户输入**：
"我今天的血压是120/80，心率75"

**工具调用**：
- record_blood_pressure(systolic=120, diastolic=80, heart_rate=75)
- query_blood_pressure()  # 查询历史数据用于点评

**模型输出**：
```json
{
    "session_id": "session_123",
    "response_content": "已为您记录血压数据：120/80 mmHg，心率75次/分。\n\n赞！血压已达标，继续加油保持！我看到您已累计打卡15天，请继续坚持，按时记录血压可以方便我更好的了解你的健康情况！",
    "reasoning_summary": "用户提供了完整的血压数据，使用record_blood_pressure工具记录。记录成功后，查询历史数据发现用户已累计打卡15天，且本次血压达标，按照单次血压数据点评规则给出达标评价。",
    "additional_fields": {
        "recorded_data": {"systolic": 120, "diastolic": 80, "heart_rate": 75},
        "evaluation": "达标",
        "total_days": 15
    }
}
```
```

3. **组织方式**：
   - 按照点评维度分类（单次点评、对比点评、趋势点评等）
   - 每个维度选择2-3个典型示例
   - 覆盖主要场景（达标、偏高、偏低、预警等）

## 三、总结

1. **对应关系**：CSV用例与提示词规则基本对应，但脉搏区间划分存在差异
2. **直接加载可行性**：❌ **不可行**，存在格式、结构、理解偏差等多方面问题
3. **推荐方案**：将CSV转换为结构化的Few-shot示例，按照点评维度分类组织，展示完整的输入输出对和JSON格式

