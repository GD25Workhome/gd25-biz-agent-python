# 测试用户数据构建文档

## 1. 示例的分析

### 1.1 示例分类概览

根据 `config/prompts/local/blood_pressure_agent_prompt.txt` 文件中的示例内容（从第236行开始），所有示例可以分为以下几大类：

#### 1.1.1 单次血压数据点评示例（8个场景）

1. **血压达标**
   - 场景特征：90<=收缩压<=收缩压目标值 且 舒张压 <= 舒张压目标值
   - 需要信息：目标血压值（收缩压目标值、舒张压目标值）

2. **低压偏低**
   - 场景特征：20mmHg<舒张压<60mmHg，且收缩压、舒张压均不超过对应设定目标值
   - 需要信息：目标血压值

3. **高压偏低**
   - 场景特征：40mmHg<=收缩压<90mmHg，且收缩压、舒张压均不超过对应设定目标值
   - 需要信息：目标血压值

4. **轻度偏高**
   - 场景特征：收缩压、舒张压任一值超过了对应设定目标值，但两者超过了均不到10mmHg
   - 需要信息：目标血压值

5. **中度偏高**
   - 场景特征：收缩压、舒张压任一值超过了对应设定目标值+10mmHg；但未超过180/110
   - 需要信息：目标血压值

6. **重度偏高-无行为**
   - 场景特征：收缩压>=180 or 舒张压>=110
   - 需要信息：目标血压值（可选）

7. **重度偏高-有行为**
   - 场景特征：收缩压>=180 or 舒张压>=110，且伴有不适症状
   - 需要信息：目标血压值（可选）

8. **重度偏高-带症状**
   - 场景特征：患者上传血压值SBP >= 180mmHg or DBP >= 110mmHg且患者在症状记录中勾选了【头昏头晕】【胸闷】【胸痛】【呼吸急促】【恶心腹胀】【视力模糊】【呕吐】【烦躁不安】之一
   - 需要信息：目标血压值（可选）

9. **波动较大且带症状**
   - 场景特征：相比患者7天内的（如有）上一次血压SBP升高/降低40mmHg及以上或DBP升高/降低20mmHg且患者在记录症状或医助随访过程中勾选了【头昏头晕】【胸闷】【胸痛】【呼吸急促】【恶心腹胀】【视力模糊】【呕吐】【烦躁不安】之一
   - 需要信息：目标血压值（可选）

#### 1.1.2 症状预警示例（3个场景）

1. **首次记录症状**
   - 场景特征：患者在症状记录中首次勾选了【头昏头晕】【胸闷】【胸痛】【呼吸急促】【恶心腹胀】【视力模糊】【咳嗽】【肢体麻木】【夜尿增多】【血尿】之一
   - 需要信息：基础高血压患者即可

2. **高脂血症患者服用他汀带症状**
   - 场景特征：新随访"高脂血症"分组有下列记录其中之一：每日任务-症状录入：患者选择使用了他汀 且记录症状中，勾选了【肌肉酸痛】【肌肉不适】【肌肉无力】之一
   - 需要信息：疾病诊断（高脂血症）、用药情况（他汀类药物）

3. **冠心病患者血压不达标且带症状**
   - 场景特征：新随访"冠心病"分组记录症状中勾选了【胸闷】【胸痛】【憋喘】之一
   - 需要信息：疾病诊断（冠心病）、目标血压值

#### 1.1.3 脉搏点评示例（5个场景）

1. **脉搏较慢**：BPM≤40
2. **脉搏偏慢**：40<BPM≤60（细分：40<BPM≤50、50<BPM≤60）
3. **脉搏正常**：60<BPM≤75（不评价）
4. **脉搏偏快**：75<BPM≤120（细分：75<BPM≤100、100<BPM≤120）
5. **脉搏较快**：BPM>120（细分：120<BPM≤150、BPM>150）

**需要信息**：基础高血压患者即可（心率信息通过血压记录中的heart_rate字段提供，不需要在user_info中体现）

#### 1.1.4 血压趋势点评示例（11个场景）

1. **下降趋势-有任何不达标数据**
   - 场景特征：血压记录>=4天，下降趋势（当Ds与Dd均<-2时），有任何不达标数据
   - 需要信息：目标血压值

2. **下降趋势-全部达标**
   - 场景特征：血压记录>=4天，下降趋势（当Ds与Dd均<-2时），全部达标
   - 需要信息：目标血压值

3. **上升趋势-有任何不达标数据**
   - 场景特征：血压记录>=4天，上升趋势（当Ds与Dd均>2时），有任何不达标数据
   - 需要信息：目标血压值

4. **上升趋势-全部达标**
   - 场景特征：血压记录>=4天，上升趋势（当Ds与Dd均>2时），全部达标
   - 需要信息：目标血压值

5. **趋势无变化-全部达标**
   - 场景特征：血压记录>=4天，趋势为无变化（-2 ≤Ds与Dd都在该区间 ≤2），全部达标
   - 需要信息：目标血压值

6. **趋势无变化-达标率71%~99%**
   - 场景特征：血压记录>=4天，趋势为无变化，近7天达标率71%~99%
   - 需要信息：目标血压值

7. **趋势无变化-达标率50%~70%**
   - 场景特征：血压记录>=4天，趋势为无变化，近7天达标率50%~70%
   - 需要信息：目标血压值

8. **趋势无变化-达标率<50%**
   - 场景特征：血压记录>=4天，趋势为无变化，近7天达标率<50%
   - 需要信息：目标血压值

9. **晨间高-时段有不达标**
   - 场景特征：达标状况+区间内波动状况+昼夜波动分析结论为——晨间高（当晨间平均收缩压高于全日平均收缩压 10%时，且晨间测量3次。整体测量>6次），时段收缩压、舒张压有不达标
   - 需要信息：目标血压值

10. **晨间高-时段全部达标**
    - 场景特征：达标状况+区间内波动状况+昼夜波动分析结论为——晨间高（当晨间平均收缩压高于全日平均收缩压 10%时，且晨间测量3次。整体测量>6次），时段收缩压、舒张压"全部"达标
    - 需要信息：目标血压值

11. **夜间高-时段有不达标**
    - 场景特征：达标状况+区间内波动状况+昼夜波动分析结论为——夜间高（当夜间平均收缩压高于全日平均收缩压10%时，且夜间测量>3次，整体测量>6次），时段收缩压、舒张压有不达标
    - 需要信息：目标血压值

12. **夜间高-时段全部达标**
    - 场景特征：达标状况+区间内波动状况+昼夜波动分析结论为——夜间高（当夜间平均收缩压高于全日平均收缩压10%时，且夜间测量>3次，整体测量>6次），时段收缩压、舒张压"全部"达标
    - 需要信息：目标血压值

13. **无突出模式-有时段不达标**
    - 场景特征：达标状况+区间内波动状况+昼夜波动分析结论为——无突出模式（晨间，夜间测量各大于三次，且不满足上面的晨间高、夜间高条件），有时段有不达标的血压
    - 需要信息：目标血压值

### 1.2 示例依赖的关键信息总结

从以上分析可以看出，示例主要依赖以下患者基础信息：

1. **目标血压值**（最重要）
   - 收缩压目标值：用于判断血压是否达标、轻度偏高、中度偏高等
   - 舒张压目标值：用于判断血压是否达标、轻度偏高、中度偏高等
   - 不同目标值可以支持不同的测试场景

2. **疾病诊断**
   - 高血压（基础，所有患者都需要）
   - 高脂血症（用于"高脂血症患者服用他汀带症状"示例）
   - 冠心病（用于"冠心病患者血压不达标且带症状"示例）

3. **用药情况**
   - 他汀类药物（用于"高脂血症患者服用他汀带症状"示例）

4. **其他基础信息**（用于展示，不影响示例判断）
   - 患者姓名
   - 年龄
   - 性别

## 2. 患者的基础信息分类与示例的对应关系

### 2.1 患者基础信息分类体系

根据示例分析，我们可以将患者基础信息分为以下几类：

#### 分类1：基础高血压患者（标准目标值）

**特征**：
- 疾病诊断：高血压
- 目标血压值：收缩压130mmHg，舒张压80mmHg（标准目标值）

**支持示例**：
- ✅ 单次血压数据点评：血压达标、轻度偏高、中度偏高、重度偏高、低压偏低、高压偏低
- ✅ 症状预警：首次记录症状
- ✅ 脉搏点评：所有脉搏点评场景（心率通过血压记录提供）
- ✅ 血压趋势点评：所有趋势点评场景（下降趋势、上升趋势、趋势无变化、晨间高、夜间高、无突出模式）

**适用场景**：这是最基础的分类，可以支持大部分示例场景。通过调整实际录入的血压数据，可以触发不同的示例。

#### 分类2：基础高血压患者（低目标值）

**特征**：
- 疾病诊断：高血压
- 目标血压值：收缩压120mmHg，舒张压75mmHg（较低目标值，更容易不达标）

**支持示例**：
- ✅ 单次血压数据点评：更容易触发轻度偏高、中度偏高场景
- ✅ 血压趋势点评：更容易出现不达标情况，支持达标率相关的示例

**适用场景**：用于测试血压不达标相关的场景，特别是达标率计算相关的示例。

#### 分类3：基础高血压患者（高目标值）

**特征**：
- 疾病诊断：高血压
- 目标血压值：收缩压140mmHg，舒张压90mmHg（较高目标值，更容易达标）

**支持示例**：
- ✅ 单次血压数据点评：更容易触发血压达标场景
- ✅ 血压趋势点评：更容易出现全部达标的情况

**适用场景**：用于测试血压达标相关的场景，特别是全部达标的趋势点评示例。

#### 分类4：高脂血症患者（服用他汀）

**特征**：
- 疾病诊断：高血压、高脂血症
- 目标血压值：收缩压130mmHg，舒张压80mmHg
- 用药情况：他汀类药物

**支持示例**：
- ✅ 单次血压数据点评：所有单次血压点评场景
- ✅ 症状预警：**高脂血症患者服用他汀带症状**（关键场景）
- ✅ 脉搏点评：所有脉搏点评场景
- ✅ 血压趋势点评：所有趋势点评场景

**适用场景**：专门用于测试"高脂血症患者服用他汀带症状"这个特殊示例。当患者记录症状中勾选了【肌肉酸痛】【肌肉不适】【肌肉无力】之一时，会触发此示例。

#### 分类5：冠心病患者

**特征**：
- 疾病诊断：高血压、冠心病
- 目标血压值：收缩压130mmHg，舒张压80mmHg
- 用药情况：降压药、抗血小板药物等

**支持示例**：
- ✅ 单次血压数据点评：所有单次血压点评场景
- ✅ 症状预警：**冠心病患者血压不达标且带症状**（关键场景）
- ✅ 脉搏点评：所有脉搏点评场景
- ✅ 血压趋势点评：所有趋势点评场景

**适用场景**：专门用于测试"冠心病患者血压不达标且带症状"这个特殊示例。当患者记录症状中勾选了【胸闷】【胸痛】【憋喘】之一时，会触发此示例。

#### 分类6：多疾病患者（高血压+高脂血症+冠心病）

**特征**：
- 疾病诊断：高血压、高脂血症、冠心病
- 目标血压值：收缩压130mmHg，舒张压80mmHg
- 用药情况：降压药、他汀类药物、抗血小板药物等

**支持示例**：
- ✅ 单次血压数据点评：所有单次血压点评场景
- ✅ 症状预警：首次记录症状、高脂血症患者服用他汀带症状、冠心病患者血压不达标且带症状（全部支持）
- ✅ 脉搏点评：所有脉搏点评场景
- ✅ 血压趋势点评：所有趋势点评场景

**适用场景**：用于测试多种疾病组合的场景，可以同时支持多个特殊症状预警示例。

### 2.2 分类与示例对应关系表

| 患者分类 | 目标血压值 | 疾病诊断 | 用药情况 | 支持的关键示例 |
|---------|-----------|---------|---------|---------------|
| 分类1：基础高血压患者（标准） | 130/80 | 高血压 | 降压药 | 所有基础示例 |
| 分类2：基础高血压患者（低目标值） | 120/75 | 高血压 | 降压药 | 不达标相关示例 |
| 分类3：基础高血压患者（高目标值） | 140/90 | 高血压 | 降压药 | 达标相关示例 |
| 分类4：高脂血症患者（服用他汀） | 130/80 | 高血压、高脂血症 | 降压药、他汀类药物 | **高脂血症患者服用他汀带症状** |
| 分类5：冠心病患者 | 130/80 | 高血压、冠心病 | 降压药、抗血小板药物 | **冠心病患者血压不达标且带症状** |
| 分类6：多疾病患者 | 130/80 | 高血压、高脂血症、冠心病 | 降压药、他汀类药物、抗血小板药物 | 所有示例（包括特殊症状预警） |

### 2.3 实际使用说明

**重要提示**：在实际测试时，患者基础信息分类只是提供了基础条件，**实际进入何种示例还需要根据最新的聊天交互和血压数据来决定**。

例如：
- 即使患者是"分类1：基础高血压患者（标准）"，如果录入的血压数据是180/110，仍然会触发"重度偏高"示例
- 即使患者是"分类4：高脂血症患者（服用他汀）"，如果没有记录【肌肉酸痛】【肌肉不适】【肌肉无力】症状，也不会触发"高脂血症患者服用他汀带症状"示例
- 即使患者是"分类5：冠心病患者"，如果血压达标且没有记录【胸闷】【胸痛】【憋喘】症状，也不会触发"冠心病患者血压不达标且带症状"示例

**测试策略**：
1. 创建不同分类的患者（覆盖所有6个分类）
2. 针对每个分类，通过录入不同的血压数据来触发不同的示例场景
3. 对于特殊症状预警示例，需要在录入血压数据时同时记录相应的症状信息

### 2.4 患者基础信息字段格式

根据设计文档，`user_info` 字段采用多行文本格式，建议格式如下：

```
患者姓名：{姓名}
年龄：{年龄}岁
性别：{性别}
疾病诊断：{疾病列表}
目标血压值：收缩压{收缩压目标值}mmHg，舒张压{舒张压目标值}mmHg
用药情况：{用药列表}
其他信息：{其他备注信息}
```

**示例1（分类1：基础高血压患者-标准）**：
```
患者姓名：张三
年龄：55岁
性别：男
疾病诊断：高血压
目标血压值：收缩压130mmHg，舒张压80mmHg
用药情况：降压药A
其他信息：无
```

**示例2（分类4：高脂血症患者-服用他汀）**：
```
患者姓名：李四
年龄：60岁
性别：女
疾病诊断：高血压、高脂血症
目标血压值：收缩压130mmHg，舒张压80mmHg
用药情况：降压药A、他汀类药物B
其他信息：无
```

**示例3（分类5：冠心病患者）**：
```
患者姓名：王五
年龄：65岁
性别：男
疾病诊断：高血压、冠心病
目标血压值：收缩压130mmHg，舒张压80mmHg
用药情况：降压药A、抗血小板药物C
其他信息：无
```

## 3. 测试用户数据生成建议

### 3.1 用户数量建议

建议为每个分类创建**至少2-3个用户**，以便：
1. 测试不同姓名、年龄、性别的组合
2. 测试相同分类下不同血压数据触发的不同示例
3. 提供足够的测试数据覆盖

**总计建议创建15-20个测试用户**。

### 3.2 用户命名规范

建议使用以下命名规范：
- 分类1：`user_bp_standard_01`、`user_bp_standard_02`、`user_bp_standard_03`
- 分类2：`user_bp_low_target_01`、`user_bp_low_target_02`
- 分类3：`user_bp_high_target_01`、`user_bp_high_target_02`
- 分类4：`user_hyperlipidemia_01`、`user_hyperlipidemia_02`
- 分类5：`user_coronary_01`、`user_coronary_02`
- 分类6：`user_multi_disease_01`、`user_multi_disease_02`

### 3.3 下一步：单元测试代码实现

基于以上分析，下一步需要实现：
1. 单元测试代码，用于批量生成测试用户
2. 每个用户包含完整的 `user_info` 字段（多行文本格式）
3. 用户数据覆盖所有6个分类
4. 支持通过测试代码快速创建和清理测试数据

